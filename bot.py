import telebot
import buttons
import database
import json
import time
import traceback
import os
from datetime import datetime
from dotenv import load_dotenv
from buttons import get_main_keyboard, get_services_keyboard, get_automatic_keyboard

load_dotenv()

BOT_TOKEN = os.getenv("BOT_TOKEN")
bot = telebot.TeleBot(BOT_TOKEN)
ADMIN_ID = os.getenv("ADMIN_ID")

@bot.message_handler(commands=['start'])
def send_welcome(message):
    user_name = message.from_user.first_name
    user_id = message.from_user.id
    database.add_user_if_not_exists(user_id, message.from_user.username)
    
    welcome_text = ("""
–î–æ–±—Ä–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫! 

–ú–µ–Ω—è –∑–æ–≤—É—Ç –®–∏—Ä–æ–∫–∞—è –î–∞—Ä—å—è.

–Ø ‚Äì –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –¥–∏—Ä–µ–∫—Ç–æ—Ä / COO —Å 5+ –≥–æ–¥–∞–º–∏ –æ–ø—ã—Ç–∞ –≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –º–∞–ª—ã–º –∏ —Å—Ä–µ–¥–Ω–∏–º –±–∏–∑–Ω–µ—Å–æ–º.

<b>–ß–µ–º —è –º–æ–≥—É –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω–∞?</b>
–Ø –ø–æ–º–æ–≥–∞—é –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—è–º —É–∫—Ä–æ—Ç–∏—Ç—å —Ö–∞–æ—Å –≤ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–∫–µ, –≤–Ω–µ–¥—Ä–∏—Ç—å —Ü–∏—Ñ—Ä–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏ –≤—ã—Å—Ç—Ä–æ–∏—Ç—å —Å–∏—Å—Ç–µ–º—É, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Å–º—ã—Å–ª–µ–Ω–Ω–æ –∏ –±–µ–∑ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è üï∞Ô∏è

<b>–ú–æ—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:</b>
‚öôÔ∏è –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ –ø–æ–ª–Ω–∞—è —Ü–∏—Ñ—Ä–æ–≤–∏–∑–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤
üìí –£–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏–µ –∏ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã –≤ –ë–∏–±–ª–∏–æ—Ç–µ–∫—É –∑–Ω–∞–Ω–∏–π –∫–æ–º–ø–∞–Ω–∏–∏ & Onboarding
ü™© –ü—Ä–µ–º–∏–∞–ª—å–Ω—ã–π WOW-—Å–µ—Ä–≤–∏—Å
‚≠êÔ∏è –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ —Å 0, —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ä–≥—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –∑–æ–Ω –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏, –≤–∑—Ä–∞—â–∏–≤–∞–Ω–∏–µ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π –∫—É–ª—å—Ç—É—Ä—ã

<b>–ì–æ—Ç–æ–≤—ã —Å–¥–µ–ª–∞—Ç—å –í–∞—à –±–∏–∑–Ω–µ—Å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ?</b>
–û–∑–Ω–∞–∫–æ–º—å—Ç–µ—Å—å —Å –º–æ–∏–º–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º–∏ –∏ –Ω–∞–ø–∏—à–∏—Ç–µ, —Å —á–µ–º –í–∞–º –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å ‚Äì —è –ø–æ–¥–≥–æ—Ç–æ–≤–ª—é –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø–æ–¥ –í–∞—à—É –∑–∞–¥–∞—á—É üíõ
""")

    bot.send_message(
        message.chat.id,
        welcome_text,
        reply_markup=buttons.get_main_keyboard(),
        parse_mode='HTML'
    )
    
    # –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏—è —Å inline-–∫–Ω–æ–ø–∫–æ–π
    bot.send_message(
        message.chat.id,
        "–•–æ—Ç–∏—Ç–µ –ø–æ–ª—É—á–∏—Ç—å —á–µ–∫-–ª–∏—Å—Ç?",
        reply_markup=buttons.get_pdf_button()
    )

@bot.callback_query_handler(func=lambda call: call.data == "get_pdf")
def send_pdf(call):
    with open("checklist.pdf", "rb") as file:
        bot.send_document(
            call.message.chat.id,
            file,
            caption="–í–∞—à —á–µ–∫-–ª–∏—Å—Ç"
        )
    bot.answer_callback_query(call.id)
    

@bot.message_handler(func=lambda m: m.text == "About me")
def send_me(message):
    bot.send_message(message.chat.id, ".......................")

@bot.message_handler(func=lambda message: message.text == "–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å")
def show_automation(message):
    bot.send_message(
        message.chat.id,
        "–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏:",
        reply_markup=buttons.get_automatic_keyboard()
    )

@bot.message_handler(func=lambda m: m.text == "–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏")
def send_cons(message):
    bot.send_message(message.chat.id, """‚òéÔ∏è–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –ø–æ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–µ–º—É –±–ª–æ–∫—É

–ß—Ç–æ? –¢–æ—á–µ—á–Ω–∞—è —ç–∫—Å–ø–µ—Ä—Ç–Ω–∞—è –ø–æ–º–æ—â—å –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –≤—ã–∑–æ–≤—É –í–∞—à–µ–≥–æ –±–∏–∑–Ω–µ—Å–∞

–ö–æ–º—É?
‚Ä¢ –°–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞–º –º–∞–ª–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞, –∫–æ—Ç–æ—Ä—ã–º –Ω—É–∂–µ–Ω –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç,
‚Ä¢ –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è–º –æ—Ç–¥–µ–ª–æ–≤, —Å—Ç–æ–ª–∫–Ω—É–≤—à–∏–º—Å—è —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ø—Ä–æ–±–ª–µ–º–æ–π,
‚Ä¢ –°—Ç–∞—Ä—Ç–∞–ø–∞–º –Ω–∞ —ç—Ç–∞–ø–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

–ß—Ç–æ –≤—Ö–æ–¥–∏—Ç?
1. –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ —Ç–µ–∫—É—â–∏—Ö –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤,
ÔªøÔªøÔªø2. –†–∞–∑–±–æ—Ä –æ—à–∏–±–æ–∫, –∫–æ—Ç–æ—Ä—ã–µ –º–µ—à–∞—é—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –±–ª–æ–∫–∞,
3. –ß–µ—Ç–∫–∏–π –æ—Ç–≤–µ—Ç –Ω–∞ –∫–ª—é—á–µ–≤–æ–π –≤–æ–ø—Ä–æ—Å —Å –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–º–∏ —Ä–µ—à–µ–Ω–∏—è–º–∏,
ÔªøÔªøÔªø4. –ü–æ–¥–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –ø–æ–¥ –±—é–¥–∂–µ—Ç –∏ –º–∞—Å—à—Ç–∞–±

–§–æ—Ä–º–∞—Ç: –æ–Ω–ª–∞–π–Ω –≤—Å—Ç—Ä–µ—á–∞ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é 1.5-2 —á–∞—Å–∞""")
    
@bot.message_handler(func=lambda m: m.text == "–ì–ª—É–±–∏–Ω–Ω—ã–π –∞—É–¥–∏—Ç")
def send_aut(message):
    bot.send_message(message.chat.id, ".......................")

@bot.message_handler(func=lambda m: m.text == "–°–æ–∑–¥–∞–Ω–∏–µ —Ü–∏—Ñ—Ä–æ–≤–æ–π —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã")      
def send_aut(message):
    bot.send_message(message.chat.id, """ü§ñ–°–æ–∑–¥–∞–Ω–∏–µ —Ü–∏—Ñ—Ä–æ–≤–æ–π —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã

–ß—Ç–æ? –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å–∞ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –≤—Å–µ—Ö —Ä–∞–±–æ—á–∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

–ö–æ–º—É?
ÔªøÔªø‚Ä¢ –ö–æ–º–ø–∞–Ω–∏–∏ —Å 5+ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏, –≥–¥–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Ç–µ—Ä—è–µ—Ç—Å—è,
ÔªøÔªø‚Ä¢ –ë–∏–∑–Ω–µ—Å—ã —Å —Ä—É—á–Ω—ã–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º,
‚Ä¢ –ö–æ–º–∞–Ω–¥—ã, –≥–æ—Ç–æ–≤—ã–µ –∫ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –¥–ª—è —Ä–æ—Å—Ç–∞

–ß—Ç–æ –≤—Ö–æ–¥–∏—Ç?
ÔªøÔªøÔªø1. –ü–æ–¥–±–æ—Ä CRM –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π —Å–µ—Ä–≤–∏—Å–æ–≤ –ø–æ–¥ –∑–∞–ø—Ä–æ—Å –±–∏–∑–Ω–µ—Å–∞, —Å–æ–∑–¥–∞–Ω–∏–µ –µ–¥–∏–Ω–æ–≥–æ —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –¥–ª—è
–≤—Å–µ—Ö –æ—Ç–¥–µ–ª–æ–≤,
ÔªøÔªøÔªø2. –ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ç—Ä–µ–∫–∏–Ω–≥ –∑–∞–¥–∞—á –∏
–Ω–∞–≥—Ä—É–∑–∫–∏ –∫–æ–º–∞–Ω–¥—ã,
ÔªøÔªøÔªø3. –û—Ü–∏—Ñ—Ä–æ–≤–∫–∞ –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –≤
—Ä–µ–≥–ª–∞–º–µ–Ω—Ç—ã, –ë–∞–∑–∞ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö –∑–Ω–∞–Ω–∏–π,
ÔªøÔªøÔªø4. –û–±—É—á–µ–Ω–∏–µ —à—Ç–∞—Ç–∞ —Ä–∞–±–æ—Ç–µ –≤
–Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ

–§–æ—Ä–º–∞—Ç: –æ–Ω–ª–∞–π–Ω –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é 1.5-2 –º–µ—Å—è—Ü–∞ —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–º –∏ –∫–æ–º–∞–Ω–¥–æ–π""")
    
@bot.message_handler(func=lambda m: m.text == "–°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–µ —Å–µ—Å—Å–∏–∏")
def send_stsess(message):
    bot.send_message(message.chat.id, """üë•–°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∞—è —Å–µ—Å—Å–∏—è —Å –∫–æ–º–∞–Ω–¥–æ–π

–ß—Ç–æ? –ò–Ω—Ç–µ–Ω—Å–∏–≤ –¥–ª—è –≤—ã—Ä–∞–±–æ—Ç–∫–∏ —á–µ—Ç–∫–æ–≥–æ –ø–ª–∞–Ω–∞ —Ä–∞–∑–≤–∏—Ç–∏—è –±–∏–∑–Ω–µ—Å–∞

–ö–æ–º—É?
‚Ä¢ –°–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫–∏ –Ω–∞ –ø–µ—Ä–µ–ø—É—Ç—å–µ —Ä–∞–∑–≤–∏—Ç–∏—è,
‚Ä¢ –ö–æ–º–∞–Ω–¥—ã –ø–æ—Å–ª–µ –∫—Ä–∏–∑–∏—Å–∞ –∏–ª–∏ —Ä–µ–∑–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π,
‚Ä¢ –ë–∏–∑–Ω–µ—Å—ã, –≤—ã—Ö–æ–¥—è—â–∏–µ –Ω–∞ –Ω–æ–≤—ã–µ —Ä—ã–Ω–∫–∏

–ß—Ç–æ –≤—Ö–æ–¥–∏—Ç?
ÔªøÔªøÔªø1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —ç—Ç–∞–ø–∞ —Ä–∞–∑–≤–∏—Ç–∏—è –±–∏–∑–Ω–µ—Å–∞, –±—Ä–∏—Ñ–∏–Ω–≥ –ø–æ —Ç–µ–∫—É—â–µ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é,
ÔªøÔªøÔªø2. –ü–æ–ª–Ω–∞—è –∫–∞—Ä—Ç–∞ –≤—Å–µ—Ö –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —Å ¬´—É–∑–∫–∏–º–∏ –º–µ—Å—Ç–∞–º–∏¬ª,
ÔªøÔªøÔªø3. –ß–µ—Ç–∫–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–µ–π –∏ –∑–æ–Ω –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –≤ –∫–æ–º–∞–Ω–¥–µ
—Å –ø–æ–º–æ—â—å—é –º–∞—Ç—Ä–∏—Ü—ã R–ê–°–Ü,
ÔªøÔªøÔªø4. –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–µ –≤–∏–¥–µ–Ω–∏–µ –≤–µ–∫—Ç–æ—Ä–æ–≤ —Ä–æ—Å—Ç–∞ –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–π –≥–æ–¥ –æ—Ç –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø—Ä–æ—Ü–µ—Å—Å–∞,
ÔªøÔªøÔªø5. –ú–æ—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞, –ø–æ–Ω–∏–º–∞—é—â–∞—è —Å–≤–æ–∏ —Ü–µ–ª–∏ –∏ –≤–∫–ª–∞–¥ –≤ –æ–±—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–§–æ—Ä–º–∞—Ç: –æ–Ω–ª–∞–π–Ω –æ—Ñ—Ñ–ª–∞–π–Ω –≤—Å—Ç—Ä–µ—á–∞ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é 3-4 —á–∞—Å–æ–≤ —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–º –∏ –∫–æ–º–∞–Ω–¥–æ–π,
–ü–æ—Å—Ç-–ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏""")

@bot.message_handler(func=lambda m: m.text == "WOW —Å–µ—Ä–≤–∏—Å")
def send_wow(message):
    bot.send_message(message.chat.id, """ü™Ñ–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ WOW-—Å–µ—Ä–≤–∏—Å–∞

–ß—Ç–æ? –ú–∞–≥–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –≤ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ

–ö–æ–º—É?
‚Ä¢ –ë–∏–∑–Ω–µ—Å—ã —Å –≤—ã—Å–æ–∫–∏–º —á–µ–∫–æ–º, –≥–¥–µ –≤–∞–∂–µ–Ω –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –æ–ø—ã—Ç,
‚Ä¢ –ö–æ–º–ø–∞–Ω–∏–∏ –≤ —Å—Ñ–µ—Ä–µ —É—Å–ª—É–≥ (HoReCa, Beauty),
‚Ä¢ –ë—Ä–µ–Ω–¥—ã, –∫–æ–Ω–∫—É—Ä–∏—Ä—É—é—â–∏–µ –∑–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤

–ß—Ç–æ –≤—Ö–æ–¥–∏—Ç?
1. –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –æ–ø—ã—Ç–∞,
2. –°–æ–∑–¥–∞–Ω–∏–µ —É–∑–Ω–∞–≤–∞–µ–º–æ–≥–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ —Å–µ—Ä–≤–∏—Å–∞, —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ WOW-—ç–ª–µ–º–µ–Ω—Ç–æ–≤,
3. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –≥–ª–∞–≤–Ω–æ–≥–æ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç–∞ –∫–æ–º–ø–∞–Ω–∏–∏ –ø–æ —Å–µ—Ä–≤–∏—Å—É, —á–µ–∫-–ª–∏—Å—Ç–æ–≤, –±—Ä–∏—Ñ–æ–≤ –∏ —Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–ª—è —Ä–∞–±–æ—Ç—ã –æ—Ç–¥–µ–ª–æ–≤,
4. –ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ –æ–±—É—á–∞—é—â–µ–≥–æ –≤–æ—Ä–∫—à–æ–ø–∞ –ø–æ —Å–µ—Ä–≤–∏—Å—É –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∫–æ–º–ø–∞–Ω–∏–∏

–§–æ—Ä–º–∞—Ç: –æ–Ω–ª–∞–π–Ω –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é 1 –º–µ—Å—è—Ü —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–º –∏ –∫–æ–º–∞–Ω–¥–æ–π""")

@bot.message_handler(func=lambda message: message.text == "–£—Å–ª—É–≥–∏") #–†–∞—Å–∫—Ä—ã–≤–∞—é—â–∞—è—Å—è reply –∫–ª–∞–≤–∞
def show_services(message):
   
    bot.send_message(
        message.chat.id,
        "–í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—É—é —É—Å–ª—É–≥—É:",
        reply_markup=buttons.get_services_keyboard()
    )

@bot.message_handler(func=lambda message: message.text == "‚óÄÔ∏è–ù–∞–∑–∞–¥")  # –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –Ω–∞–∑–∞–¥
def back_to_main(message):
    bot.send_message(
        message.chat.id,
        "–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:",
        reply_markup=buttons.get_main_keyboard()
    )

# --- –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
@bot.message_handler(commands=['adduser'])
def add_user(message):
    if message.from_user.id != ADMIN_ID:
        bot.reply_to(message, "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —ç—Ç—É –∫–æ–º–∞–Ω–¥—É.")
        return

    try:
        _, user_id_str, username = message.text.split()
        user_id = int(user_id_str)
        database.add_user(user_id, username)
        bot.reply_to(message, f"‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id} –¥–æ–±–∞–≤–ª–µ–Ω.")
    except Exception:
        bot.reply_to(message, "‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /adduser <id> <username>")


@bot.message_handler(commands=['deluser'])
def del_user(message):
    if message.from_user.id != ADMIN_ID:
        bot.reply_to(message, "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —ç—Ç—É –∫–æ–º–∞–Ω–¥—É.")
        return

    try:
        _, user_id_str = message.text.split()
        user_id = int(user_id_str)
        database.remove_user(user_id)
        bot.reply_to(message, f"‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id} —É–¥–∞–ª—ë–Ω.")
    except Exception:
        bot.reply_to(message, "‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /deluser <id>")

@bot.message_handler(commands=['stats']) # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω—É –æ—á–µ–≤–∏–¥–Ω–æ –∂–µ —á—Ç–æ –æ–Ω–∞ –¥–µ–ª–∞–µ—Ç 
def show_stats(message):
    if str(message.from_user.id) != ADMIN_ID:
        return
    
    top_commands = database.get_top_commands()
    response = "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–º–∞–Ω–¥:\n" + "\n".join(
        f"{cmd}: {count} —Ä–∞–∑" for cmd, count in top_commands
    )
    bot.reply_to(message, response)



#–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
def run_bot():
    print("ü§ñ Telegram-–±–æ—Ç –∑–∞–ø—É—â–µ–Ω...")
    database.init_db()
    
    while True:
        try:
            print("–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞...")
            bot.polling(none_stop=True, interval=1, timeout=20)
        except Exception as e:
            print(f"‚ö†Ô∏è –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: {e}")
            traceback.print_exc()  # –ü–µ—á–∞—Ç—å –ø–æ–ª–Ω–æ–≥–æ —Å—Ç–µ–∫–∞ –æ—à–∏–±–∫–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
            print("–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥...")
            time.sleep(5)  # –ü–∞—É–∑–∞ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º
